# zipper_08_08_2025
Тестовое задание "Сервис загрузки запакованных файлов"

## Использованные сторонние библиотеки
- веб-сервер - Gin
- google/uuid - уникальные id
- imroc/req - скачивание файлов по ссылкам
- joho/godotenv - работа с env

## Запуск
Чтобы протестировать сервис, необходимо склонировать репозиторий. Можно запустить сразу (сервер стартует на localhost:8080), либо поменять хост и порт в .env файле. Пример заполнения показан в .env.example.

## Способ хранения и учета сессий
Дабы не использовать БД и другие сервисы, позволяющие хранить данные о сессиях, решено было использовать map'ы, поэтому при каждом запуске учет сессий сбрасывается. Так же после завершения скачивания zip архива - исходная папка удаляется и сессия считается завершенной, поэтому доступа к ней больше не будет (она удаляется через 15 секунд).

## Использованные технологии распараллеливания и паттерны

- Для распределенного и быстрого скачивания решено было использовать WaitGroups
- Чтобы исключить гонку горутин, был создан глобальный Mutex, для ограничения доступа к данным у горутин
- Для ограничения доступных сессий был использован паттерн "Semaphore", дополнительно, после проверки существующих сессий
- В целом весь код преимущественно написан по принципу "Одна задача - одна функция" 

## Использование
### Имеется 3 эндпоинта:

<table>
  <th>
    Роут
  </th>
  <th>
    Описание
  </th>
  <th>
    Вывод
  </th>
  <tr>
    <td>
      /task/
    </td>
    <td>
      Создает задачу на загрузку файлов
    </td>
    <td>
      "uuid": "уникальный айди вашей сессии"
    </td>
  </tr>
  <tr>
    <td>
      /:uuid/upload/
    </td>
    <td>
      Загрузка файлов в каталог
    </td>
    <td>
      "message": "files uploaded" - 200<br>
      "error": описание - 400
    </td>
  </tr>
  <tr>
    <td>
      /:uuid/download/
    </td>
    <td>
      Создание zip архива + выгрузка его пользователю
    </td>
    <td>
      "message": "zip file created successfully. downloading will start automatically. files will be removed from the server in 15 sec." - 200<br>
      "error": описание - 400
    </td>
  </tr>
</table>

### Обратите внимание!!!
- Если проверять работу через Postman - придется открывать zip вручную из корня проекта
- При проверке через браузер скачивание zip начинается автоматически
- При загрузке сразу 3 допустимых файлов происходит автоматический редирект на загрузку
- С целью экономии ресурсов, после загрузки zip, исходная папка удаляется
